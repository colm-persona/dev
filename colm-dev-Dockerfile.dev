FROM persona

RUN echo "Configuring Colm's dev environment..."

USER 1000:1000

RUN sudo apt-get update && \
    sudo apt-get install -y \
    ninja-build gettext cmake unzip curl build-essential tmux ripgrep

# build neovim
RUN git clone https://github.com/neovim/neovim.git /home/vscode/neovim && \
    cd /home/vscode/neovim && \
    git checkout stable && \
    make CMAKE_BUILD_TYPE=RelWithDebInfo && \
    sudo make install

# get our configuration's dependencies
RUN git clone --depth 1 https://github.com/wbthomason/packer.nvim\
 /home/vscode/.local/share/nvim/site/pack/packer/start/packer.nvim

# Copy my dotfiles
COPY ./dotfiles/.config/nvim /home/vscode/.config/nvim/
COPY ./dotfiles/.config/tmux /home/vscode/.config/tmux/
COPY ./dotfiles/.tmux.conf /home/vscode/.tmux.conf

# Configure tmux
RUN git clone https://github.com/tmux-plugins/tpm /home/vscode/.tmux/plugins/tpm &&\
    /home/vscode/.tmux/plugins/tpm/bin/install_plugins

# install plugins and quit when done
RUN nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerClean'
RUN nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
RUN nvim --headless -c 'sleep 10' -c 'qall'
RUN nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'

RUN sudo chown -R 1000:1000 /home/vscode/.config
RUN sudo chmod -R 755 /home/vscode/.config
