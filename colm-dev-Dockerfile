FROM mcr.microsoft.com/devcontainers/python:1-3.11-bookworm

RUN echo "Configuring Colm's dev environment..."

RUN sudo apt-get update && \
    sudo apt-get install -y ninja-build gettext cmake unzip curl build-essential tmux ripgrep

# Clone my dotfiles
RUN git clone https://github.com/colm-persona/dotfiles.git /root/.dotfiles

# Copy configuration files to good location
RUN cp -R /root/.dotfiles/.config /root/.dotfiles/.tmux.conf /root/

# Configure tmux
RUN git clone https://github.com/tmux-plugins/tpm /root/.tmux/plugins/tpm &&\
    /root/.tmux/plugins/tpm/bin/install_plugins

# build neovim
RUN git clone https://github.com/neovim/neovim.git /root/neovim && \
    cd /root/neovim && \
    git checkout stable && \
    make CMAKE_BUILD_TYPE=RelWithDebInfo && \
    make install

# get our configuration's dependencies
RUN git clone --depth 1 https://github.com/wbthomason/packer.nvim\
 ~/.local/share/nvim/site/pack/packer/start/packer.nvim

# install plugins and quit when done
RUN nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerClean'
RUN nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
RUN nvim --headless -c 'sleep 10' -c 'qall'
RUN nvim --headless -c 'autocmd User PackerComplete quitall' -c 'PackerSync'
